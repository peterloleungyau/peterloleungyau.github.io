<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>More Guix: Private Channel and Internal Package - Peter&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Peter Lo" /><meta name="description" content="Having introduced the basic ideas of Guix in previous posts, this time we explore setting up a private Guix channel. Guix package definitions are managed with git repositories called channels. There is an official channel at https://git.sjtu.edu.cn/sjtug/guix.git, there are also third party channels such as https://gitlab.com/nonguix/nonguix (for some software which cannot be included in the official distribution for ethical or policy-related reasons) and https://github.com/guix-science/guix-science.git (for scientific software, which cannot be included upstream)." />






<meta name="generator" content="Hugo 0.83.0 with even 4.0.0" />


<link rel="canonical" href="https://peterloleungyau.github.io/post/more_guix_private_channel/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="More Guix: Private Channel and Internal Package" />
<meta property="og:description" content="Having introduced the basic ideas of Guix in previous posts, this time we explore setting up a private Guix channel. Guix package definitions are managed with git repositories called channels. There is an official channel at https://git.sjtu.edu.cn/sjtug/guix.git, there are also third party channels such as https://gitlab.com/nonguix/nonguix (for some software which cannot be included in the official distribution for ethical or policy-related reasons) and https://github.com/guix-science/guix-science.git (for scientific software, which cannot be included upstream)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://peterloleungyau.github.io/post/more_guix_private_channel/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-15T00:00:00&#43;08:00" />
<meta property="article:modified_time" content="2021-07-15T00:00:00&#43;08:00" />

<meta itemprop="name" content="More Guix: Private Channel and Internal Package">
<meta itemprop="description" content="Having introduced the basic ideas of Guix in previous posts, this time we explore setting up a private Guix channel. Guix package definitions are managed with git repositories called channels. There is an official channel at https://git.sjtu.edu.cn/sjtug/guix.git, there are also third party channels such as https://gitlab.com/nonguix/nonguix (for some software which cannot be included in the official distribution for ethical or policy-related reasons) and https://github.com/guix-science/guix-science.git (for scientific software, which cannot be included upstream)."><meta itemprop="datePublished" content="2021-07-15T00:00:00&#43;08:00" />
<meta itemprop="dateModified" content="2021-07-15T00:00:00&#43;08:00" />
<meta itemprop="wordCount" content="4244">
<meta itemprop="keywords" content="Guix,Functional Package Manager,Reproducibility," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="More Guix: Private Channel and Internal Package"/>
<meta name="twitter:description" content="Having introduced the basic ideas of Guix in previous posts, this time we explore setting up a private Guix channel. Guix package definitions are managed with git repositories called channels. There is an official channel at https://git.sjtu.edu.cn/sjtug/guix.git, there are also third party channels such as https://gitlab.com/nonguix/nonguix (for some software which cannot be included in the official distribution for ethical or policy-related reasons) and https://github.com/guix-science/guix-science.git (for scientific software, which cannot be included upstream)."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Peter&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Peter&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">More Guix: Private Channel and Internal Package</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-07-15 </span>
        <div class="post-category">
            <a href="/categories/guix/"> Guix </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#motivation-for-private-guix-channel">Motivation for private Guix channel</a></li>
    <li><a href="#private-guix-channel-as-git-repository">Private Guix channel as git repository</a>
      <ul>
        <li><a href="#create-a-simple-private-guix-channel">Create a simple private Guix channel</a></li>
        <li><a href="#demo-add-a-sample-r-package-built-from-github">Demo: add a sample R package built from Github</a></li>
      </ul>
    </li>
    <li><a href="#optional--channel-authentication">(Optional) Channel Authentication</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Having introduced the basic ideas of Guix in previous posts, this time
we explore setting up a private Guix channel. Guix package definitions
are managed with git repositories called <em>channels</em>. There is an
official channel at <a href="https://git.sjtu.edu.cn/sjtug/guix.git">https://git.sjtu.edu.cn/sjtug/guix.git</a>, there are
also third party channels such as <a href="https://gitlab.com/nonguix/nonguix">https://gitlab.com/nonguix/nonguix</a>
(for some software which cannot be included in the official
distribution for ethical or policy-related reasons) and
<a href="https://github.com/guix-science/guix-science.git">https://github.com/guix-science/guix-science.git</a> (for scientific
software, which cannot be included upstream). Unsurprisingly, you can
setup your own Guix channels for your internal packages. This time we
explore setting up private channels for your custom packages. With the
private channel and custom packages, we could enjoy the benefits of
Guix in per-project dependency management (and other benefits) by
maintaining a channels file and a manifest file for each project.</p>
<h2 id="motivation-for-private-guix-channel">Motivation for private Guix channel</h2>
<p>Although it is recommended that you contribute package definitions to
Guix proper (see <a href="https://guix.gnu.org/manual/en/html%5Fnode/Creating-a-Channel.html">Creating a Channel</a> and
see <a href="https://guix.gnu.org/manual/en/html%5Fnode/Contributing.html">contributing</a> for details on how to contribute package
definitions), there are still reasons that you may want to maintain
private channels:</p>
<ul>
<li>
<p>a needed package is not in the official channel (yet):</p>
<p>If a needed package is not currently available in the official
channel (or other third party channels), then you can either try to
import it with <code>guix import</code> (see <a href="https://guix.gnu.org/manual/en/html%5Fnode/Invoking-guix-import.html#Invoking-guix-import">Invoking guix import</a>), or write
the package definition yourself. After that, you are encouraged to
submit a patch to add the package to the official Guix channel (see
<a href="https://guix.gnu.org/manual/en/html%5Fnode/Contributing.html">contributing</a> for details). But it takes time for the maintainers to
review and merge the patch. Meanwhile, you may choose to add the new
package definition to your private channel, so that you can continue
with your work.</p>
</li>
<li>
<p>a package is internal and should not be made public:</p>
<p>If you do not wish to make a needed package public, e.g. internal
package in your company, it is natural to put the package definition
in a private channel, so that you can still enjoy the benefits of
Guix for dependency management.</p>
</li>
</ul>
<h2 id="private-guix-channel-as-git-repository">Private Guix channel as git repository</h2>
<p>For convenience, we setup a git repository on <a href="https://github.com/">Github</a>, but other git
repository providers such as <a href="https://about.gitlab.com/">GitLab</a>, <a href="https://bitbucket.org/">Bitbucket</a> should also work just
fine.</p>
<h3 id="create-a-simple-private-guix-channel">Create a simple private Guix channel</h3>
<p>Reference: <a href="https://guix.gnu.org/manual/en/html%5Fnode/Creating-a-Channel.html">Creating a Channel</a></p>
<ol>
<li>
<p>Create a Github account at <a href="https://github.com/signup?ref%5Fcta=Sign+up&amp;ref%5Floc=header+logged+out&amp;ref%5Fpage=%2F&amp;source=header-home">Sign up</a> if you do not already have one</p>
</li>
<li>
<p>Setup SSH key for Github for convenience</p>
<ul>
<li>
<p>Refer to <a href="https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">Generating a new SSH key and adding it to the ssh-agent</a>
and <a href="https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account">Adding a new SSH key to your GitHub account</a> to conveniently
access your Github account and private repositories without
entering password.</p>
</li>
<li>
<p>NOTE: I previously generated SSH key following the above
guidelines from Github, and can push to and pull from my private
repository just fine. But at the later testing step, Guix is
unable to access the private channel with this error:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ guix time-machine -C channels.scm --disable-authentication --
environment --ad-hoc python-radian
Updating channel <span class="s1">&#39;guix&#39;</span> from Git repository at
<span class="s1">&#39;https://git.savannah.gnu.org/git/guix.git&#39;</span>...
guix time-machine: warning: channel authentication disabled
Updating channel <span class="s1">&#39;my-guix-pkgs&#39;</span> from Git repository at
<span class="s1">&#39;git@github.com:peterloleungyau/my-guix-pkgs.git&#39;</span>...
guix time-machine: error: Git error: Failed to retrieve list of SSH
authentication methods: Failed getting response
</code></pre></td></tr></table>
</div>
</div><p>After some googling, it seems to be a bug in <code>libssh2</code> which Guix
uses for retrieving private channels:</p>
<ul>
<li><a href="https://github.com/libgit2/pygit2/issues/1013">https://github.com/libgit2/pygit2/issues/1013</a></li>
<li><a href="https://github.com/saltstack/salt/issues/57121">https://github.com/saltstack/salt/issues/57121</a></li>
</ul>
<p>The suggested workaround is to generate the key in PEM format by
using the option <code>-m PEM</code> in <code>ssh-keygen</code>, so I have tried this
command to generate the SSH key and followed the rest of the
instructions to add the public key to Github (and moved my old SSH
keys from my <code>~/.ssh/</code> to a temporary folder) and then Guix can
access the private repository (from both Guix in foreign
distribution and Guix system):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ssh-keygen -m PEM -t rsa -b <span class="m">4096</span> -C <span class="s2">&#34;peterloleungyau@gmail.com&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>So if at the time that you are reading this and get the same
error as above (which means the bug in <code>libssh2</code> is probably
still unfixed), then you may try the above workaround.</p>
</li>
<li>
<p>Make sure your ssh-agent is setup properly so that the key(s)
added persist across reboots. E.g. refer to
<a href="https://stackoverflow.com/questions/3466626/how-to-permanently-add-a-private-key-with-ssh-add-on-ubuntu">https://stackoverflow.com/questions/3466626/how-to-permanently-add-a-private-key-with-ssh-add-on-ubuntu</a></p>
</li>
</ul>
</li>
<li>
<p>Create a (private) git repository</p>
<ol>
<li>
<p>Signin your GitHub account</p>
</li>
<li>
<p>Click &ldquo;New repository&rdquo; in the &ldquo;+&rdquo; drop down menu at top right corner</p>
<ul>
<li>
<p>Fill in the &ldquo;Repository name&rdquo;, here we use <code>my-guix-pkgs</code></p>
</li>
<li>
<p>Optionally fill in description, e.g. &ldquo;my private channel of Guix packages&rdquo;</p>
</li>
<li>
<p>choose whether this repository is &ldquo;Public&rdquo; or &ldquo;Private&rdquo;. For illustration of internal packages, we choose &ldquo;Private&rdquo;. You may also choose to make the channel public, i.e. as a third party channel.</p>
</li>
<li>
<p>Optionally choose whether to initialize with a <code>README.md</code> file, a <code>.gitignore</code>, and a license.</p>
</li>
<li>
<p>Click &ldquo;Create repository&rdquo; to finish</p>
<p>#+CAPTION Create new repository on Github
<img src="/ox-hugo/more_guix_private_channel_create_repo.png" alt=""></p>
</li>
</ul>
</li>
<li>
<p>Follow the instructions to clone it to your local machine, repeated here for convenience:</p>
<ul>
<li>
<p>In your terminal, assuming you already have <a href="https://git-scm.com/downloads">git</a> installed, clone
with the <code>git clone</code> command, note that the exact URL will depend
on your Github user name and your chosen repository name:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># note that your url may be different, depending on your username and chosen repo name</span>
<span class="c1"># the general url will be git@github.com:&lt;user-name&gt;/&lt;repository-name&gt;.git</span>
<span class="c1"># also, we choose &#34;SSH&#34; because we already have setup the SSH key</span>
git clone git@github.com:peterloleungyau/my-guix-pkgs.git
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Note that if you have not added anything (e.g. README.md,
<code>.gitignore</code>, or license) in the previous step, your
repository will now be empty, but we will add content to it
soon.</p>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Add personal package definitions</p>
<p>The repository can contain package definitions organized as <a href="https://www.gnu.org/software/guile/manual/guile.html#Modules">Guile
modules</a>, as different sub-directories. For example, if you have a
file <code>my-packages/ds-tools.scm</code>, it corresponds to a Guile module
<code>(my-packages ds-tools)</code>. You may organize the packages in a
sensible way you like.</p>
<p>For this illustration, we first create one file in the
repository. At the time of writing, <a href="https://pypi.org/project/radian/">radian</a>, which is &ldquo;A 21 century R
console&rdquo;, is still not in the official Guix repository. And in a
previous post <a href="/post/guix_intro_6_dev/">Guix Introduction Part 6: R Development with Guix</a> we
used <code>guix import</code> to import the relevant package and dependencies
for <code>radian</code> (I know, I should have submitted this to the Guix
channel as patch, but I am kind of lazy, and life gets in the
way). So for illustration, we will use those package definitions as
example.</p>
<ol>
<li>
<p>Under your git repository cloned above, put the following file
as <code>my-packages/ds-tools.scm</code> (note that we remove the last line
<code>python-radian</code> which is only needed when the file is used with
the <code>-l</code> option, but not needed in a channel):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">define-module</span> <span class="p">(</span><span class="nf">my-packages</span> <span class="nv">ds-tools</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">licenses</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">download</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">git-download</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">statistics</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">python</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">python-science</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">python-xyz</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">libffi</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">check</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">terminals</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">build-system</span> <span class="nv">python</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-public</span> <span class="nv">python-lineedit</span>
  <span class="p">(</span><span class="nf">package</span>
    <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;python-lineedit&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">version</span> <span class="s">&#34;0.1.6&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">source</span>
      <span class="p">(</span><span class="nf">origin</span>
        <span class="p">(</span><span class="nf">method</span> <span class="nv">url-fetch</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">uri</span> <span class="p">(</span><span class="nf">pypi-uri</span> <span class="s">&#34;lineedit&#34;</span> <span class="nv">version</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">sha256</span>
          <span class="p">(</span><span class="nf">base32</span>
            <span class="s">&#34;0gvggy22s3qlz3r5lrwr5f4hzwbq7anyd2vfrzchldaf2mwm8ygl&#34;</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">build-system</span> <span class="nv">python-build-system</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">arguments</span> <span class="o">`</span><span class="p">(</span><span class="o">#</span><span class="nv">:tests?</span> <span class="no">#f</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">propagated-inputs</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;python-pygments&#34;</span> <span class="o">,</span><span class="nv">python-pygments</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-six&#34;</span> <span class="o">,</span><span class="nv">python-six</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-wcwidth&#34;</span> <span class="o">,</span><span class="nv">python-wcwidth</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">native-inputs</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;python-pexpect&#34;</span> <span class="o">,</span><span class="nv">python-pexpect</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-ptyprocess&#34;</span> <span class="o">,</span><span class="nv">python-ptyprocess</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pyte&#34;</span> <span class="o">,</span><span class="nv">python-pyte</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pytest&#34;</span> <span class="o">,</span><span class="nv">python-pytest</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pytest-cov&#34;</span> <span class="o">,</span><span class="nv">python-pytest-cov</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">home-page</span> <span class="s">&#34;https://github.com/randy3k/lineedit&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">synopsis</span>
      <span class="s">&#34;An readline library based on prompt_toolkit which supports multiple modes&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">description</span>
      <span class="s">&#34;An readline library based on prompt_toolkit which supports multiple modes&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">license</span> <span class="no">#f</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-public</span> <span class="nv">python-rchitect</span>
  <span class="p">(</span><span class="nf">package</span>
    <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;python-rchitect&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">version</span> <span class="s">&#34;0.3.30&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">source</span>
      <span class="p">(</span><span class="nf">origin</span>
        <span class="p">(</span><span class="nf">method</span> <span class="nv">url-fetch</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">uri</span> <span class="p">(</span><span class="nf">pypi-uri</span> <span class="s">&#34;rchitect&#34;</span> <span class="nv">version</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">sha256</span>
          <span class="p">(</span><span class="nf">base32</span>
            <span class="s">&#34;1bg5vrgp447czgmjjky84yqqk2mfzwwgnf0m99lqzs7jq15q8ziv&#34;</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">build-system</span> <span class="nv">python-build-system</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">arguments</span> <span class="o">`</span><span class="p">(</span><span class="o">#</span><span class="nv">:tests?</span> <span class="no">#f</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">propagated-inputs</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;python-cffi&#34;</span> <span class="o">,</span><span class="nv">python-cffi</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-six&#34;</span> <span class="o">,</span><span class="nv">python-six</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">native-inputs</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;python-pytest&#34;</span> <span class="o">,</span><span class="nv">python-pytest</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pytest-runner&#34;</span> <span class="o">,</span><span class="nv">python-pytest-runner</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pytest-cov&#34;</span> <span class="o">,</span><span class="nv">python-pytest-cov</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pytest-mock&#34;</span> <span class="o">,</span><span class="nv">python-pytest-mock</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">home-page</span> <span class="s">&#34;https://github.com/randy3k/rchitect&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">synopsis</span> <span class="s">&#34;Mapping R API to Python&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">description</span> <span class="s">&#34;Mapping R API to Python&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">license</span> <span class="no">#f</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-public</span> <span class="nv">python-pyte</span>
  <span class="p">(</span><span class="nf">package</span>
    <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;python-pyte&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">version</span> <span class="s">&#34;0.8.0&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">source</span>
     <span class="p">(</span><span class="nf">origin</span>
       <span class="p">(</span><span class="nf">method</span> <span class="nv">url-fetch</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">uri</span> <span class="p">(</span><span class="nf">pypi-uri</span> <span class="s">&#34;pyte&#34;</span> <span class="nv">version</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">sha256</span>
        <span class="p">(</span><span class="nf">base32</span>
         <span class="s">&#34;1ic8b9xrg76z55qrvbgpwrgg0mcq0dqgy147pqn2cvrdjwzd0wby&#34;</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">build-system</span> <span class="nv">python-build-system</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">arguments</span>
     <span class="o">&#39;</span><span class="p">(</span><span class="o">#</span><span class="nv">:phases</span>
       <span class="p">(</span><span class="nf">modify-phases</span> <span class="nv">%standard-phases</span>
         <span class="p">(</span><span class="nf">add-after</span> <span class="ss">&#39;unpack</span> <span class="ss">&#39;remove-failing-test</span>
           <span class="c1">;; TODO: Reenable when the `captured` files required by this test</span>
           <span class="c1">;; are included in the archive.</span>
           <span class="p">(</span><span class="k">lambda </span><span class="nv">_</span>
             <span class="p">(</span><span class="nf">delete-file</span> <span class="s">&#34;tests/test_input_output.py&#34;</span><span class="p">)</span>
             <span class="no">#t</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nf">propagated-inputs</span>
     <span class="o">`</span><span class="p">((</span><span class="s">&#34;python-wcwidth&#34;</span> <span class="o">,</span><span class="nv">python-wcwidth</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">native-inputs</span>
     <span class="o">`</span><span class="p">((</span><span class="s">&#34;python-pytest-runner&#34;</span> <span class="o">,</span><span class="nv">python-pytest-runner</span><span class="p">)</span>
       <span class="p">(</span><span class="s">&#34;python-pytest&#34;</span> <span class="o">,</span><span class="nv">python-pytest</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">home-page</span> <span class="s">&#34;https://pyte.readthedocs.io/&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">synopsis</span> <span class="s">&#34;Simple VTXXX-compatible terminal emulator&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">description</span> <span class="s">&#34;@code{pyte} is an in-memory VTxxx-compatible terminal
</span><span class="s">emulator.  @var{VTxxx} stands for a series of video terminals, developed by
</span><span class="s">DEC between 1970 and 1995.  The first and probably most famous one was the
</span><span class="s">VT100 terminal, which is now a de-facto standard for all virtual terminal
</span><span class="s">emulators.
</span><span class="s">
</span><span class="s">pyte is a fork of vt102, which was an incomplete pure Python implementation
</span><span class="s">of VT100 terminal.&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">license</span> <span class="nv">lgpl3+</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-public</span> <span class="nv">python-radian</span>
  <span class="p">(</span><span class="nf">package</span>
    <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;python-radian&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">version</span> <span class="s">&#34;0.5.10&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">source</span>
      <span class="p">(</span><span class="nf">origin</span>
        <span class="p">(</span><span class="nf">method</span> <span class="nv">url-fetch</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">uri</span> <span class="p">(</span><span class="nf">pypi-uri</span> <span class="s">&#34;radian&#34;</span> <span class="nv">version</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">sha256</span>
          <span class="p">(</span><span class="nf">base32</span>
            <span class="s">&#34;0plkv3qdgfxyrmg2k6c866q5p7iirm46ivhq2ixs63zc05xdbg8s&#34;</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">build-system</span> <span class="nv">python-build-system</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">arguments</span> <span class="o">`</span><span class="p">(</span><span class="o">#</span><span class="nv">:tests?</span> <span class="no">#f</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">propagated-inputs</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;python-lineedit&#34;</span> <span class="o">,</span><span class="nv">python-lineedit</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pygments&#34;</span> <span class="o">,</span><span class="nv">python-pygments</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-rchitect&#34;</span> <span class="o">,</span><span class="nv">python-rchitect</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-six&#34;</span> <span class="o">,</span><span class="nv">python-six</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">native-inputs</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;python-coverage&#34;</span> <span class="o">,</span><span class="nv">python-coverage</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pexpect&#34;</span> <span class="o">,</span><span class="nv">python-pexpect</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-ptyprocess&#34;</span> <span class="o">,</span><span class="nv">python-ptyprocess</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pytest-runner&#34;</span> <span class="o">,</span><span class="nv">python-pytest-runner</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pyte&#34;</span> <span class="o">,</span><span class="nv">python-pyte</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;python-pytest&#34;</span> <span class="o">,</span><span class="nv">python-pytest</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">home-page</span> <span class="s">&#34;https://github.com/randy3k/radian&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">synopsis</span> <span class="s">&#34;A 21 century R console&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">description</span> <span class="s">&#34;A 21 century R console&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">license</span> <span class="no">#f</span><span class="p">)))</span>

</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Commit and push the file: in the terminal, in the directory of
your cloned repository, type:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># at the repository directory</span>
<span class="c1"># stage the file</span>
git add my-packages/ds-tools.scm

<span class="c1"># check that the file is properly added</span>
git status

<span class="c1"># commit, with a commit message</span>
git commit -m <span class="s2">&#34;Added ds-tools.scm&#34;</span>

<span class="c1"># push to GitHub</span>
git push
</code></pre></td></tr></table>
</div>
</div><p>Now if you go to your GitHub repository, you should also see the
committed file.</p>
</li>
</ol>
</li>
<li>
<p>Test the private channel</p>
<ol>
<li>
<p>Create a channels file <code>channels.scm</code> somewhere, e.g. at <code>~/</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">channel</span>
       <span class="p">(</span><span class="nf">name</span> <span class="ss">&#39;guix</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;https://git.savannah.gnu.org/git/guix.git&#34;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">commit</span> <span class="s">&#34;9904a15a4c838362673c1affdbaf1e83d92fe8ff&#34;</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">channel</span>
       <span class="p">(</span><span class="nf">name</span> <span class="ss">&#39;my-guix-pkgs</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;git@github.com:peterloleungyau/my-guix-pkgs.git&#34;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">commit</span> <span class="s">&#34;8cacb5380cb0339bd36238173d80354539ca4a59&#34;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">branch</span> <span class="s">&#34;master&#34;</span><span class="p">)))</span>

</code></pre></td></tr></table>
</div>
</div><p>Note that it is recommended that you explicitly specify the
branch of the private channel, and you should check whether the
default branch is <code>master</code> or <code>main</code>, e.g. by checking from your
Github.</p>
<p>Also, you should replace the commit of <code>my-guix-pkgs</code>
(<code>8cacb5380cb0339bd36238173d80354539ca4a59</code>) above with the
commit of your private channel repository, which you can check
with <code>git log</code> in that repository. Yours may not be the same as
mine here, because I made more than one commit in creating the
repository above.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git log
commit 8cacb5380cb0339bd36238173d80354539ca4a59 <span class="o">(</span>HEAD -&gt; master, origin/master, origin/HEAD<span class="o">)</span>
Author: Peter Lo &lt;peterloleungyau@gmail.com&gt;
Date:   Thu Jul <span class="m">8</span> 00:28:35 <span class="m">2021</span> +0800

    Define module <span class="k">for</span> ds-tools.

commit b51d236ebbbdd134bafb64e5092342a2d058ec2a
Author: Peter Lo &lt;peterloleungyau@gmail.com&gt;
Date:   Wed Jul <span class="m">7</span> 00:12:31 <span class="m">2021</span> +0800

    Added ds-tools.scm
<span class="o">(</span>END<span class="o">)</span>

</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Try to create a Guix environment by:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># replace ~/channels.scm with the proper path to your created channels.scm</span>
guix time-machine -C ~/channels.scm -- environment --ad-hoc python-radian r-minimal -- radian
</code></pre></td></tr></table>
</div>
</div><p>Then wait for a while, if all goes well, then you should be in a
<code>radian</code> REPL.</p>
</li>
</ol>
</li>
</ol>
<h3 id="demo-add-a-sample-r-package-built-from-github">Demo: add a sample R package built from Github</h3>
<p>We also try to add a custom R package to our private channel, and also
put the R package in a <em>private</em> repository, to illustrate creating
internal package.</p>
<ol>
<li>Repository for R package
<ul>
<li>Reference for creating R package: the book <a href="https://r-pkgs.org/index.html">R Packages</a> by Hadley
Wickham and Jenny Bryan. <a href="https://r-pkgs.org/whole-game.html">Chapter 2</a> of the book gives an example
of creating a toy package.</li>
<li><a href="https://gist.github.com/peterhurford/f71bf00d8866094eac6c">Notes on Hadley&rsquo;s &ldquo;R Packages&rdquo;</a> gives a quick summary of the book.</li>
<li>The book has an example R package at
<a href="https://github.com/jennybc/foofactors">https://github.com/jennybc/foofactors</a> which is a good example
because it depends on the <a href="https://rdrr.io/cran/forcats/man/forcats-package.html">forcats</a> package, which is available as
<code>r-forcats</code>, which is in the official Guix channel.</li>
<li>We could have used this repository directly if we want to test an
R package at public repository.</li>
<li>Since we want to test an R at private repository, we will clone
the repository and create a private one. I tried forking the
repository, but after that Github does not allow changing the
forked repository from public to private &ldquo;for security reasons&rdquo;.
<ol>
<li>
<p>First clone <a href="https://github.com/jennybc/foofactors">https://github.com/jennybc/foofactors</a> to your
local machine, say at the home directory:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># e.g. we clone to the home directory</span>
<span class="nb">cd</span> ~
git clone https://github.com/jennybc/foofactors.git
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Create a <strong>private</strong> empty repository at Github using the same
steps as above in creating the private channel repository. I
will keep the same name for this repository,
i.e. <code>foofactors</code>. So the URL of my repository is
<code>git@github.com:peterloleungyau/foofactors.git</code></p>
</li>
<li>
<p>Push the local cloned repository to the empty repository at
Github:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> ~/foofactors
<span class="c1"># change the remote origin to the new URL</span>
git remote set-url origin git@github.com:peterloleungyau/foofactors.git
<span class="c1"># now can push</span>
git push
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Use <code>git log</code> to check the latest commit of the repository, to
be used below. At the time of writing, the latest commit is
<code>ef71e8d2e82fa80e0cfc249fd42f50c01924326d</code></p>
</li>
<li>
<p>(Optional) You may check at Github that the repository is
no longer empty.</p>
</li>
</ol>
</li>
</ul>
</li>
<li>Package definition for the R package
<ul>
<li>
<p>Besides using <code>guix import</code> to import existing package (e.g. from
CRAN), the easiest way to write a package definition is to modify
from a similar package.</p>
</li>
<li>
<p>In our case, we want to write a package definition for an R
package at Github.</p>
</li>
<li>
<p>It would be convenient to clone the official Guix repository
(<a href="https://git.savannah.gnu.org/git/guix.git">https://git.savannah.gnu.org/git/guix.git</a>) to your local
machine:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">git clone https://git.savannah.gnu.org/git/guix.git
<span class="c1"># or you can do a shallow clone to get only the latest commit, to save time</span>
<span class="c1"># git clone --depth 1 https://git.savannah.gnu.org/git/guix.git</span>
</code></pre></td></tr></table>
</div>
</div><p>Alternatively you may try to find cloned Guix repository at
Github, e.g. <a href="https://github.com/zimoun/guix">https://github.com/zimoun/guix</a></p>
</li>
<li>
<p>Most R CRAN packages are in <code>gnu/packages/cran.scm</code></p>
</li>
<li>
<p>So we may search <code>git</code> in <code>cran.scm</code> to see if we can find some
useful package definitions as reference:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># find anything related to git</span>
grep -w -C <span class="m">5</span> git ~/guix/gnu/packages/cran.scm
<span class="c1"># or you can open cran.scm with your favorite text editor and search</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>At the time of writing, the Guix repo is at commit
<code>7760d28920a920791645c4485f1345af45ee7787</code>, and from the above
search, it seems <code>r-sankeyd3</code> is useful as a reference, because
it uses an explicit commit from a git repository as the package
source. Its package definition is reproduced here for easy
reference:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">define-public</span> <span class="nv">r-sankeyd3</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">commit</span> <span class="s">&#34;fd50a74e29056e0d67d75b4d04de47afb2f932bc&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">revision</span> <span class="s">&#34;1&#34;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">package</span>
     <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;r-sankeyd3&#34;</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">version</span> <span class="p">(</span><span class="nf">git-version</span> <span class="s">&#34;0.3.2&#34;</span> <span class="nv">revision</span> <span class="nv">commit</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">source</span>
      <span class="p">(</span><span class="nf">origin</span>
       <span class="p">(</span><span class="nf">method</span> <span class="nv">git-fetch</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">uri</span> <span class="p">(</span><span class="nf">git-reference</span>
             <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;https://github.com/fbreitwieser/sankeyD3&#34;</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">commit</span> <span class="nv">commit</span><span class="p">)))</span>
       <span class="p">(</span><span class="nf">file-name</span> <span class="p">(</span><span class="nf">git-file-name</span> <span class="nv">name</span> <span class="nv">version</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">sha256</span>
        <span class="p">(</span><span class="nf">base32</span>
         <span class="s">&#34;0jrcnfax321pszbpjdifnkbrgbjr43bjzvlzv1p5a8wskksqwiyx&#34;</span><span class="p">))))</span>
     <span class="p">(</span><span class="nf">build-system</span> <span class="nv">r-build-system</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">propagated-inputs</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;r-d3r&#34;</span> <span class="o">,</span><span class="nv">r-d3r</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;r-htmlwidgets&#34;</span> <span class="o">,</span><span class="nv">r-htmlwidgets</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;r-shiny&#34;</span> <span class="o">,</span><span class="nv">r-shiny</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;r-magrittr&#34;</span> <span class="o">,</span><span class="nv">r-magrittr</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">home-page</span> <span class="s">&#34;https://github.com/fbreitwieser/sankeyD3&#34;</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">synopsis</span> <span class="s">&#34;Sankey network graphs from R&#34;</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">description</span>
      <span class="s">&#34;This package provides an R library to generate Sankey network graphs
</span><span class="s">in R and Shiny via the D3 visualization library.&#34;</span><span class="p">)</span>
     <span class="c1">;; The R code is licensed under GPLv3+.  It includes the non-minified</span>
     <span class="c1">;; JavaScript source code of d3-sankey, which is released under the</span>
     <span class="c1">;; 3-clause BSD license.</span>
     <span class="p">(</span><span class="nf">license</span> <span class="p">(</span><span class="nb">list </span><span class="nv">license:gpl3+</span> <span class="nv">license:bsd-3</span><span class="p">)))))</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>We note a few things of the package definition:</p>
<ul>
<li>name: <code>r-sankeyd3</code>, the Guix convention for R package is to
have the <code>r-</code> prefix, and prefer lower case.</li>
<li>commit: <code>fd50a74e29056e0d67d75b4d04de47afb2f932bc</code> is the git commit</li>
<li>version: 0.3.2</li>
<li>revision: &ldquo;1&rdquo;, seems here just for the version name</li>
<li>url: the URL of the git repository</li>
<li>sha256: seems some kind of hash in base32 format</li>
<li>build-system: <code>r-build-system</code> as this is an R package</li>
<li>propagated-inputs: the dependencies, which will be installed
<em>visibly</em> (i.e. as if the user also manually installed the
propagated input) together with this package</li>
<li>home-page: the homepage of the package</li>
<li>synopsis: a short description of the package</li>
<li>description: a longer description of the package</li>
<li>license: seems can specify one or more licenses as a list</li>
</ul>
</li>
<li>
<p>We therefore need to figure out these information for <code>foofactors</code></p>
</li>
<li>
<p>The <code>foofactors/DESCRIPTION</code> file provides a lot of useful
information, reproduced below for convenience:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Package: foofactors
Title: Make Factors Less Aggravating
Version: 0.0.0.9000
Authors@R:
    person(&#34;Jane&#34;, &#34;Doe&#34;, email = &#34;jane@example.com&#34;, role = c(&#34;aut&#34;, &#34;cre&#34;))
Description: Factors have driven people to extreme measures, like ordering
    custom conference ribbons and laptop stickers to express how HELLNO we
    feel about stringsAsFactors. And yet, sometimes you need them. Can they
    be made less maddening? Let&#39;s find out.
License: MIT + file LICENSE
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.1.1
Suggests:
    testthat
Imports:
    forcats

</code></pre></td></tr></table>
</div>
</div><ul>
<li>name: following the convention we will use <code>r-foofactors</code></li>
<li>version: 0.0.0.9000</li>
<li>revision: can just use 1</li>
<li>commit: determined above using <code>git log</code> to be <code>ef71e8d2e82fa80e0cfc249fd42f50c01924326d</code></li>
<li>url: the URL of the private repository
<code>git@github.com:peterloleungyau/foofactors.git</code></li>
<li>sha256: this is a hash of the source content
<ul>
<li>
<p>if the source is fetched with <code>url-fetch</code>, then we can use
<code>guix download</code> command at the terminal to download and
calculate the hash</p>
</li>
<li>
<p>but since now the source is fetched with <code>git-fetch</code>,
and currently <code>guix download</code> does not support this</p>
</li>
<li>
<p>instead, according to the <a href="https://guix.gnu.org/cookbook/en/html%5Fnode/Extended-example.html">Extended example</a> of Guix packing,
we can use <code>guix hash</code> on the <strong>freshly</strong> cloned repository as
follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># clone the repository, make sure the content is not changed</span>
git clone git@github.com:peterloleungyau/foofactors.git
<span class="c1"># go to the repo</span>
<span class="nb">cd</span> foofactors
<span class="c1"># checkout the latest commit</span>
<span class="c1"># alternatively, you can checkout a specific commit</span>
git checkout HEAD
<span class="c1"># finally calculate hash</span>
guix <span class="nb">hash</span> -rx .
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>in our case, the calculated hash is <code>1hmfwac2zdl8x6r21yy5b257c4891106ana4j81hfn6rd0rl9f72</code></p>
</li>
</ul>
</li>
<li>build-system: <code>r-build-system</code> as this is an R package</li>
<li>propagated-inputs: this package imports <code>forcats</code>, so include
<code>r-forcats</code> which is in Guix&rsquo;s official repository already</li>
<li>home-page: can simply use the original Github repository
<a href="https://github.com/jennybc/foofactors">https://github.com/jennybc/foofactors</a></li>
<li>synopsis: a short description, maybe modify from the title &ldquo;A R package to make factors less aggravating.&rdquo;</li>
<li>description: just copy the description above.</li>
<li>license: MIT license, which is called <a href="https://www.gnu.org/licenses/license-list.html#Expat">expat</a> in Guix, which is
<code>license:expat</code> in <code>guix/licenses.scm</code>.</li>
</ul>
</li>
<li>
<p>With the above determined information, and referring to
<code>gnu/packages/cran.scm</code> of the Guix repository to add some needed
modules, we add the following file to our local channel
repository at <code>~/my-guix-pkgs/my-packages/r-pkgs.scm</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">define-module</span> <span class="p">(</span><span class="nf">my-packages</span> <span class="nv">r-pkgs</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">((</span><span class="nf">guix</span> <span class="nv">licenses</span><span class="p">)</span> <span class="o">#</span><span class="nv">:prefix</span> <span class="nv">license:</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">packages</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">download</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">git-download</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">utils</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">build-system</span> <span class="nv">r</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">statistics</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-public</span> <span class="nv">r-foofactors</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">commit</span> <span class="s">&#34;ef71e8d2e82fa80e0cfc249fd42f50c01924326d&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">revision</span> <span class="s">&#34;1&#34;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">package</span>
      <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;r-foofactors&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">version</span> <span class="p">(</span><span class="nf">git-version</span> <span class="s">&#34;0.0.0.9000&#34;</span> <span class="nv">revision</span> <span class="nv">commit</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">source</span>
       <span class="p">(</span><span class="nf">origin</span>
         <span class="p">(</span><span class="nf">method</span> <span class="nv">git-fetch</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">uri</span> <span class="p">(</span><span class="nf">git-reference</span>
               <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;git@github.com:peterloleungyau/foofactors.git&#34;</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">commit</span> <span class="nv">commit</span><span class="p">)))</span>
         <span class="p">(</span><span class="nf">file-name</span> <span class="p">(</span><span class="nf">git-file-name</span> <span class="nv">name</span> <span class="nv">version</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">sha256</span>
          <span class="p">(</span><span class="nf">base32</span>
           <span class="s">&#34;1hmfwac2zdl8x6r21yy5b257c4891106ana4j81hfn6rd0rl9f72&#34;</span><span class="p">))))</span>
      <span class="p">(</span><span class="nf">build-system</span> <span class="nv">r-build-system</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">propagated-inputs</span>
       <span class="o">`</span><span class="p">((</span><span class="s">&#34;r-forcats&#34;</span> <span class="o">,</span><span class="nv">r-forcats</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">home-page</span> <span class="s">&#34;https://github.com/jennybc/foofactors&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">synopsis</span> <span class="s">&#34;A R package to make factors less aggravating.&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">description</span>
       <span class="s">&#34;Factors have driven people to extreme measures, like ordering
</span><span class="s">custom conference ribbons and laptop stickers to express how HELLNO we
</span><span class="s">feel about stringsAsFactors. And yet, sometimes you need them. Can they
</span><span class="s">be made less maddening? Let&#39;s find out.&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">license</span> <span class="nv">license:expat</span><span class="p">))))</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that we define a module corresponding to the path of the file,
and we use some modules that seem to be needed, and also the
<code>(gnu packages statistics)</code> module because the package depends on
<code>r-forcats</code> which resides in <code>(gnu packages statistics)</code> by
checking with <code>guix search r-forcats</code> which shows the location of
the file to be <code>gnu/packages/statistics.scm:5588:2</code>.</p>
<p>But the above package definition has not been tested yet, and as
we will see, it has problem that needs a workaround.</p>
</li>
<li>
<p>Local testing before committing and pushing</p>
<ul>
<li>
<p>Before committing and pushing the package definition, it is good
to first test building and using it locally, so that we can fix
problem in the package definition.</p>
</li>
<li>
<p>We may try to build it using <code>guix build</code>. With the <code>-L</code>
option, we can specify extra path containing modules to be
pre-pended to existing channels, so that we can test
packages not yet committed to the channel.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># use the previous channels file, so that its dependencies will be consistent.</span>
guix time-machine -C ~/channels.scm -- build -L ~/my-guix-pkgs/ r-foofactors

</code></pre></td></tr></table>
</div>
</div><p>But then this gave error that &ldquo;ssh is not found&rdquo;, so
<code>git-fetch</code> is unable to fetch from the private repository. Asking
in the <a href="https://lists.gnu.org/mailman/listinfo/guix-devel">guix-devel@gnu.org</a> mailing list confirms that currently
<code>git-fetch</code> is indeed unable to fetch private repository over
ssh, and Luis Felipe suggested a workaround of using
<code>git-checkout</code> directly instead of using <code>origin</code> and
<code>git-fetch</code>:</p>
<ul>
<li><a href="https://lists.gnu.org/archive/html/guix-devel/2021-07/msg00090.html">https://lists.gnu.org/archive/html/guix-devel/2021-07/msg00090.html</a></li>
<li><a href="https://lists.gnu.org/archive/html/guix-devel/2021-07/msg00091.html">https://lists.gnu.org/archive/html/guix-devel/2021-07/msg00091.html</a></li>
</ul>
</li>
<li>
<p>We therefore modify the package definition above to use
<code>git-checkout</code> and confirm that it can be built successfully
(assuming your SSH key and ssh-agent has been setup correctly):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">define-module</span> <span class="p">(</span><span class="nf">my-packages</span> <span class="nv">r-pkgs</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">((</span><span class="nf">guix</span> <span class="nv">licenses</span><span class="p">)</span> <span class="o">#</span><span class="nv">:prefix</span> <span class="nv">license:</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">packages</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">download</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">git</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">git-download</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">utils</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">guix</span> <span class="nv">build-system</span> <span class="nv">r</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:use-module</span> <span class="p">(</span><span class="nf">gnu</span> <span class="nv">packages</span> <span class="nv">statistics</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-public</span> <span class="nv">r-foofactors</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">commit</span> <span class="s">&#34;ef71e8d2e82fa80e0cfc249fd42f50c01924326d&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">revision</span> <span class="s">&#34;1&#34;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">package</span>
      <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;r-foofactors&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">version</span> <span class="p">(</span><span class="nf">git-version</span> <span class="s">&#34;0.0.0.9000&#34;</span> <span class="nv">revision</span> <span class="nv">commit</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">source</span>
       <span class="p">(</span><span class="nf">git-checkout</span>
        <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;git@github.com:peterloleungyau/foofactors.git&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">commit</span> <span class="nv">commit</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">build-system</span> <span class="nv">r-build-system</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">propagated-inputs</span>
       <span class="o">`</span><span class="p">((</span><span class="s">&#34;r-forcats&#34;</span> <span class="o">,</span><span class="nv">r-forcats</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">home-page</span> <span class="s">&#34;https://github.com/jennybc/foofactors&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">synopsis</span> <span class="s">&#34;A R package to make factors less aggravating.&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">description</span>
       <span class="s">&#34;Factors have driven people to extreme measures, like ordering
</span><span class="s">custom conference ribbons and laptop stickers to express how HELLNO we
</span><span class="s">feel about stringsAsFactors. And yet, sometimes you need them. Can they
</span><span class="s">be made less maddening? Let&#39;s find out.&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">license</span> <span class="nv">license:expat</span><span class="p">))))</span>

</code></pre></td></tr></table>
</div>
</div><p>Note that we have added the <code>(guix git)</code> module for <code>git-checkout</code>. We
have also changed <code>origin</code> to <code>git-checkout</code>, and the source hash is
no longer needed. Since a commit of a git repository is already
some kind of hash, we can still be confident that the source has not been
tampered with.</p>
</li>
<li>
<p>Now that the package can be built, we also try it in a <code>guix environment</code> which can also accept the <code>-L</code> option for extra
module path, together with R:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">guix time-machine -C ~/channels.scm -- environment -L ~/my-guix-pkgs/ --ad-hoc r-foofactors r-minimal -- R
</code></pre></td></tr></table>
</div>
</div><p>This should give an R REPL, then we may try the quick demo
shown in the README of <a href="https://github.com/jennybc/foofactors">https://github.com/jennybc/foofactors</a></p>
</li>
</ul>
</li>
<li>
<p>After the local testing, we may update the private channel,
commit and push:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># get to the private repository directory</span>
<span class="nb">cd</span> ~/my-guix-pkgs/
<span class="c1"># add, commit, push</span>
git add my-packages/r-pkgs.scm
git commit -m <span class="s2">&#34;Added r-foofactors.&#34;</span>
git push
<span class="c1"># also note the latest commit</span>
git log
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>Test the package from Guix through the private channel
<ol>
<li>
<p>Update the channels file for updated commit</p>
<p>With the updated private channel, we also update the channels
file <code>~/channels.scm</code> for updated commit, which is
<code>13255b9d3550bc8b2ff8b987d3d5621447783a3f</code> from <code>git log</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">channel</span>
       <span class="p">(</span><span class="nf">name</span> <span class="ss">&#39;guix</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;https://git.savannah.gnu.org/git/guix.git&#34;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">commit</span> <span class="s">&#34;9904a15a4c838362673c1affdbaf1e83d92fe8ff&#34;</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">channel</span>
       <span class="p">(</span><span class="nf">name</span> <span class="ss">&#39;my-guix-pkgs</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;git@github.com:peterloleungyau/my-guix-pkgs.git&#34;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">commit</span> <span class="s">&#34;13255b9d3550bc8b2ff8b987d3d5621447783a3f&#34;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">branch</span> <span class="s">&#34;master&#34;</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><p>In general, when a channel is updated, it is just a simple
matter of updating the commit in channels file as above, <em>when</em>
a project needs to use the updated package(s),</p>
</li>
<li>
<p>Try to create a Guix environment with updated channels file</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">guix time-machine -C ~/channels.scm -- environment --ad-hoc r-foofactors r-minimal -- R
</code></pre></td></tr></table>
</div>
</div><p>And we can try the same quick demo as above, and verify that we
get the expected results.</p>
</li>
</ol>
</li>
</ol>
<h2 id="optional--channel-authentication">(Optional) Channel Authentication</h2>
<p>The above setup of private channel and custom packages is sufficient
for needs of teams for internal packages. You may choose to add
channel authentication.
References:</p>
<ul>
<li><a href="https://guix.gnu.org/manual/en/html%5Fnode/Creating-a-Channel.html#Creating-a-Channel">Creating a Channel</a></li>
<li><a href="https://guix.gnu.org/manual/en/html%5Fnode/Channel-Authentication.html">Channel Authentication</a></li>
<li><a href="https://guix.gnu.org/manual/en/html%5Fnode/Specifying-Channel-Authorizations.html">Specifying Channel Authorizations</a></li>
</ul>
<p>Here we just briefly point to some relevant material.  There are a few
things needed:</p>
<ol>
<li>
<p>Setup OpenPGP key for each committer</p>
<ul>
<li>e.g. refer to <a href="https://askubuntu.com/questions/100281/how-do-i-make-a-pgp-key">https://askubuntu.com/questions/100281/how-do-i-make-a-pgp-key</a></li>
<li>e.g. refer to <a href="https://nsrc.org/workshops/2014/btnog/raw-attachment/wiki/Track3Agenda/2-1-1.pgp-lab.html">Installing and Using PGP</a></li>
</ul>
</li>
<li>
<p>Export the OpenPGP key of all committers, e.g. with <code>gpg --export</code></p>
<ul>
<li>refer to <a href="https://nsrc.org/workshops/2014/btnog/raw-attachment/wiki/Track3Agenda/2-1-1.pgp-lab.html#exporting-your-public-key-with-gpg">Exporting your public key with GPG</a></li>
</ul>
</li>
<li>
<p>Introduce an initial <code>.guix-authorizations</code> which lists the keys
of each authorized developer. And the commit should be signed.</p>
<ul>
<li>
<p>refer to <a href="https://guix.gnu.org/manual/en/html%5Fnode/Commit-Access.html">Commit Access</a> for signing git commits</p>
</li>
<li>
<p>an example <code>.guix-authorizations</code> is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="c1">;; Example &#39;.guix-authorizations&#39; file.</span>

<span class="p">(</span><span class="nf">authorizations</span>
 <span class="p">(</span><span class="nf">version</span> <span class="mi">0</span><span class="p">)</span>               <span class="c1">;current file format version</span>

 <span class="p">((</span><span class="s">&#34;AD17 A21E F8AE D8F1 CC02  DBD9 F8AE D8F1 765C 61E3&#34;</span>
   <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;alice&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&#34;2A39 3FFF 68F4 EF7A 3D29  12AF 68F4 EF7A 22FB B2D5&#34;</span>
   <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;bob&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&#34;CABB A931 C0FF EEC6 900D  0CFB 090B 1199 3D9A EBB5&#34;</span>
   <span class="p">(</span><span class="nf">name</span> <span class="s">&#34;charlie&#34;</span><span class="p">))))</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>Put all the OpenPGP keys that were ever mentioned in
<code>.guix-authorizations</code>, stored as (either binary or ASCII-armored)
<code>.key</code> files, put in the branch named <code>keyring</code>.</p>
</li>
<li>
<p>Advertise the channel introduction, for instance in the README of
the channel. The channel introduction looks like this and contains
the key for the first commit of the channel:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">channel</span>
  <span class="p">(</span><span class="nf">name</span> <span class="ss">&#39;some-channel</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;https://example.org/some-channel.git&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">introduction</span>
   <span class="p">(</span><span class="nf">make-channel-introduction</span>
    <span class="s">&#34;6f0d8cc0d88abb59c324b2990bfee2876016bb86&#34;</span>
    <span class="p">(</span><span class="nf">openpgp-fingerprint</span>
     <span class="s">&#34;CABB A931 C0FF EEC6 900D  0CFB 090B 1199 3D9A EBB5&#34;</span><span class="p">))))</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>You may look at these examples of third party channels to see the
parts mentioned above:</p>
<ul>
<li><a href="https://gitlab.com/nonguix/nonguix">https://gitlab.com/nonguix/nonguix</a></li>
<li><a href="https://github.com/guix-science/guix-science.git">https://github.com/guix-science/guix-science.git</a></li>
</ul>
<h2 id="summary">Summary</h2>
<p>We have demonstrated setting up a private channel as a private GitHub
repository, for internal R packages, where the package source can be
in private GitHub repository. This setup is sufficient for using Guix
for per-project dependency management in the presence of internal
packages, by maintaining a channels file and a manifest file for each
project. We also briefly point out the steps needed to authenticate
the private channel, though this is optional.</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Peter Lo</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2021-07-15
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/guix/">Guix</a>
          <a href="/tags/functional-package-manager/">Functional Package Manager</a>
          <a href="/tags/reproducibility/">Reproducibility</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/guix_intro_6_dev/">
            <span class="next-text nav-default">Guix Introduction Part 6: R Development with Guix</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'https-peterloleungyau-github-io';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:peterloleungyau@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/leung-yau-lo-7a3274167/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/peterloleungyau" class="iconfont icon-github" title="github"></a>
  <a href="https://peterloleungyau.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Peter Lo</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-139262854-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
