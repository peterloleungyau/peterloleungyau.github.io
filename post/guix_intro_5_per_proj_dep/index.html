<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Guix Introduction Part 5: Per-Project Depedency Management - Peter&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Peter Lo" /><meta name="description" content="This is the fifth part of a brief introduction to the Guix functional package manager, and how it could be used to manage dependencies of projects, much like virtual environments for Python, but with much larger scope.
This time we show a little demo of managing per-project dependencies with Guix, through the guix time-machine and guix environment commands.
Demo settings Suppose we have two projects ~/guix_demo/proj1 and ~/guix_demo/proj2, each with different channel file channels." />






<meta name="generator" content="Hugo 0.83.0 with even 4.0.0" />


<link rel="canonical" href="https://peterloleungyau.github.io/post/guix_intro_5_per_proj_dep/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Guix Introduction Part 5: Per-Project Depedency Management" />
<meta property="og:description" content="This is the fifth part of a brief introduction to the Guix functional package manager, and how it could be used to manage dependencies of projects, much like virtual environments for Python, but with much larger scope.
This time we show a little demo of managing per-project dependencies with Guix, through the guix time-machine and guix environment commands.
Demo settings Suppose we have two projects ~/guix_demo/proj1 and ~/guix_demo/proj2, each with different channel file channels." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://peterloleungyau.github.io/post/guix_intro_5_per_proj_dep/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-05-13T00:00:00&#43;08:00" />
<meta property="article:modified_time" content="2021-05-13T00:00:00&#43;08:00" />

<meta itemprop="name" content="Guix Introduction Part 5: Per-Project Depedency Management">
<meta itemprop="description" content="This is the fifth part of a brief introduction to the Guix functional package manager, and how it could be used to manage dependencies of projects, much like virtual environments for Python, but with much larger scope.
This time we show a little demo of managing per-project dependencies with Guix, through the guix time-machine and guix environment commands.
Demo settings Suppose we have two projects ~/guix_demo/proj1 and ~/guix_demo/proj2, each with different channel file channels."><meta itemprop="datePublished" content="2021-05-13T00:00:00&#43;08:00" />
<meta itemprop="dateModified" content="2021-05-13T00:00:00&#43;08:00" />
<meta itemprop="wordCount" content="2140">
<meta itemprop="keywords" content="Guix,Functional Package Manager,Reproducibility," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Guix Introduction Part 5: Per-Project Depedency Management"/>
<meta name="twitter:description" content="This is the fifth part of a brief introduction to the Guix functional package manager, and how it could be used to manage dependencies of projects, much like virtual environments for Python, but with much larger scope.
This time we show a little demo of managing per-project dependencies with Guix, through the guix time-machine and guix environment commands.
Demo settings Suppose we have two projects ~/guix_demo/proj1 and ~/guix_demo/proj2, each with different channel file channels."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Peter&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Peter&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Guix Introduction Part 5: Per-Project Depedency Management</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-05-13 </span>
        <div class="post-category">
            <a href="/categories/guix/"> Guix </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#demo-settings">Demo settings</a>
      <ul>
        <li><a href="#sample-files">Sample files</a></li>
      </ul>
    </li>
    <li><a href="#open-a-shell-for-the-first-project">Open a shell for the first project</a></li>
    <li><a href="#open-another-shell-for-the-second-project">Open another shell for the second project</a></li>
    <li><a href="#close-both-shells">Close both shells</a></li>
    <li><a href="#run-r-script-for-the-first-project">Run R script for the first project</a></li>
    <li><a href="#run-r-script-for-the-second-project">Run R script for the second project</a></li>
    <li><a href="#a-possible-way-to-manage-dependency-using-guix-on-jenkins">A possible way to manage dependency using Guix on Jenkins</a></li>
    <li><a href="#what-s-next">What&rsquo;s next?</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>This is the fifth part of a brief introduction to the Guix functional
package manager, and how it could be used to manage dependencies of
projects, much like virtual environments for Python, but with much
larger scope.</p>
<p>This time we show a little demo of managing per-project dependencies
with Guix, through the <code>guix time-machine</code> and <code>guix environment</code>
commands.</p>
<h2 id="demo-settings">Demo settings</h2>
<p>Suppose we have two projects <code>~/guix_demo/proj1</code> and
<code>~/guix_demo/proj2</code>, each with different channel file <code>channels.scm</code>
and manifest file <code>pkgs.scm</code>, so the two projects use different
versions of R (proj1 at R 3.6.3, proj2 at R 4.0.3) and different R
packages (at different versions).</p>
<p>Below we spawn two shells that allow us to work on the two projects
<em>at the same time</em>, and we show most of the output. If you try the
commands, you should get the same outputs, except possibly the locale
output from R which depends on your local setting.</p>
<h3 id="sample-files">Sample files</h3>
<p>You may either manually create the following files, or clone the git
repository <a href="https://github.com/peterloleungyau/guix%5Fdemo">https://github.com/peterloleungyau/guix_demo</a> created for
convenience (you should check that the files are the same as below).</p>
<p>If you are in Guix but somehow do not have <code>git</code> installed yet, you
may install it and then clone the repository by:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># install git, and also need ssh</span>
guix package -i git openssh
<span class="c1"># clone the repo</span>
<span class="nb">cd</span> ~
git clone https://github.com/peterloleungyau/guix_demo.git
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>First project</p>
<ul>
<li>
<p><code>~/guix_demo/proj1/channels.scm</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">channel</span>
       <span class="p">(</span><span class="nf">name</span> <span class="ss">&#39;guix</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;https://git.savannah.gnu.org/git/guix.git&#34;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">commit</span> <span class="s">&#34;89909327d017198969436237acc7c93823ff8147&#34;</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>~/guix_demo/proj1/pkgs.scm</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">specifications-&gt;manifest</span>
 <span class="o">&#39;</span><span class="p">(</span>
   <span class="c1">;; R</span>
   <span class="s">&#34;r&#34;</span>
   <span class="s">&#34;r-yaml&#34;</span>
   <span class="s">&#34;r-xgboost&#34;</span>
   <span class="s">&#34;r-jsonlite&#34;</span>
   <span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>~/guix_demo/proj1/fit1.R</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="nf">library</span><span class="p">(</span><span class="n">xgboost</span><span class="p">)</span>

<span class="nf">data</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>

<span class="n">is_setosa</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span> <span class="o">==</span> <span class="s">&#34;setosa&#34;</span><span class="p">)</span>
<span class="n">iris_x</span> <span class="o">&lt;-</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">iris</span><span class="nf">[c</span><span class="p">(</span><span class="s">&#34;Sepal.Length&#34;</span><span class="p">,</span> <span class="s">&#34;Sepal.Width&#34;</span><span class="p">,</span>
                           <span class="s">&#34;Petal.Length&#34;</span><span class="p">,</span> <span class="s">&#34;Petal.Width&#34;</span><span class="p">)</span><span class="n">]</span><span class="p">)</span>
<span class="n">iris_data</span> <span class="o">&lt;-</span> <span class="nf">xgb.DMatrix</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">iris_x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">is_setosa</span><span class="p">)</span>

<span class="n">param</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="n">max_depth</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">eta</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">nthread</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
              <span class="n">objective</span> <span class="o">=</span> <span class="s">&#34;binary:logistic&#34;</span><span class="p">,</span> <span class="n">eval_metric</span> <span class="o">=</span> <span class="s">&#34;auc&#34;</span><span class="p">)</span>

<span class="n">fit</span> <span class="o">&lt;-</span> <span class="nf">xgboost</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">param</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">iris_data</span><span class="p">,</span> <span class="n">nrounds</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>Second project</p>
<ul>
<li>
<p><code>~/guix_demo/proj2/channels.scm</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">channel</span>
       <span class="p">(</span><span class="nf">name</span> <span class="ss">&#39;guix</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">url</span> <span class="s">&#34;https://git.savannah.gnu.org/git/guix.git&#34;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">commit</span> <span class="s">&#34;9904a15a4c838362673c1affdbaf1e83d92fe8ff&#34;</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>~/guix_demo/proj2/pkgs.scm</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="nf">specifications-&gt;manifest</span>
 <span class="o">&#39;</span><span class="p">(</span>
   <span class="c1">;; R</span>
   <span class="s">&#34;r&#34;</span>
   <span class="s">&#34;r-glmnet&#34;</span>
   <span class="s">&#34;r-jsonlite&#34;</span>
   <span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>~/guix_demo/proj2/fit2.R</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="nf">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span>

<span class="nf">data</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>

<span class="n">is_setosa</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span> <span class="o">==</span> <span class="s">&#34;setosa&#34;</span><span class="p">)</span>
<span class="n">iris_x</span> <span class="o">&lt;-</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">iris</span><span class="nf">[c</span><span class="p">(</span><span class="s">&#34;Sepal.Length&#34;</span><span class="p">,</span> <span class="s">&#34;Sepal.Width&#34;</span><span class="p">,</span>
                           <span class="s">&#34;Petal.Length&#34;</span><span class="p">,</span> <span class="s">&#34;Petal.Width&#34;</span><span class="p">)</span><span class="n">]</span><span class="p">)</span>

<span class="n">fit</span> <span class="o">&lt;-</span> <span class="nf">glmnet</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">iris_x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">is_setosa</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&#34;binomial&#34;</span><span class="p">)</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<h2 id="open-a-shell-for-the-first-project">Open a shell for the first project</h2>
<p>First open a new shell with Guix (could be the Guix package manager on
a Linux distribution, or the Guix system) to create an environment for
proj1:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> ~/guix_demo/proj1
guix time-machine -C channels.scm -- environment --ad-hoc -m pkgs.scm -- R
</code></pre></td></tr></table>
</div>
</div><p>Then wait a while for the R prompt to appear. The first time executing
the above may take quite some time to download and/or build the
packages. Subsequent runs should be much faster after the needed
packages are cached.</p>
<p>In the R REPL, we load the few packages and show their versions:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">R version 3.6.3 (2020-02-29) -- &#34;Holding the Windsock&#34;
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type &#39;license()&#39; or &#39;licence()&#39; for distribution details.

R is a collaborative project with many contributors.
Type &#39;contributors()&#39; for more information and
&#39;citation()&#39; on how to cite R or R packages in publications.

Type &#39;demo()&#39; for some demos, &#39;help()&#39; for on-line help, or
&#39;help.start()&#39; for an HTML browser interface to help.
Type &#39;q()&#39; to quit R.

&gt; library(xgboost)
&gt; library(yaml)
&gt; library(jsonlite)
&gt; sessionInfo()
R version 3.6.3 (2020-02-29)
Platform: x86_64-unknown-linux-gnu (64-bit)

Matrix products: default
BLAS/LAPACK: /gnu/store/vax1vsg3ivf0r7j7n2xkbi1z3r0504l9-openblas-0.3.7/lib/libopenblasp-r0.3.7.so

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] jsonlite_1.6.1  yaml_2.2.1      xgboost_1.0.0.2

loaded via a namespace (and not attached):
[1] compiler_3.6.3    magrittr_1.5      Matrix_1.2-18     tools_3.6.3
[5] stringi_1.4.6     grid_3.6.3        data.table_1.12.8 lattice_0.20-41
&gt;
</code></pre></td></tr></table>
</div>
</div><h2 id="open-another-shell-for-the-second-project">Open another shell for the second project</h2>
<p>Then <em>while keeping the first shell open</em> with the R prompt, we open a
new shell, then do the same for proj2:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> ~/guix_demo/proj2
guix time-machine -C channels.scm -- environment --ad-hoc -m pkgs.scm -- R
</code></pre></td></tr></table>
</div>
</div><p>In the R REPL, we also load the packages and show the versions:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">R version 4.0.3 (2020-10-10) -- &#34;Bunny-Wunnies Freak Out&#34;
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type &#39;license()&#39; or &#39;licence()&#39; for distribution details.

R is a collaborative project with many contributors.
Type &#39;contributors()&#39; for more information and
&#39;citation()&#39; on how to cite R or R packages in publications.

Type &#39;demo()&#39; for some demos, &#39;help()&#39; for on-line help, or
&#39;help.start()&#39; for an HTML browser interface to help.
Type &#39;q()&#39; to quit R.

&gt; library(glmnet)
Loading required package: Matrix
Loaded glmnet 4.1
&gt; library(jsonlite)
&gt; sessionInfo()
R version 4.0.3 (2020-10-10)
Platform: x86_64-unknown-linux-gnu (64-bit)

Matrix products: default
BLAS/LAPACK: /gnu/store/bs9pl1f805ins80xaf4s3n35a0x2lyq3-openblas-0.3.9/lib/libopenblasp-r0.3.9.so

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] jsonlite_1.7.2 glmnet_4.1     Matrix_1.3-2

loaded via a namespace (and not attached):
[1] compiler_4.0.3   survival_3.2-7   splines_4.0.3    codetools_0.2-18
[5] grid_4.0.3       iterators_1.0.13 foreach_1.5.1    shape_1.4.5
[9] lattice_0.20-41
&gt;
</code></pre></td></tr></table>
</div>
</div><p>You may try running some R commands in both shells to see that they
are running at the same time.</p>
<h2 id="close-both-shells">Close both shells</h2>
<p>Since we directly run <code>R</code> when creating the <code>guix environment</code>, so
now quitting R with <code>q()</code> will also exit the spawn shell. So now we
can exit both shells spawn above.</p>
<p>If you now re-run the above commands, it should be much faster,
because the needed packages are cached, and Guix needs only to check
that the packages needed are there.</p>
<h2 id="run-r-script-for-the-first-project">Run R script for the first project</h2>
<p>We also run an R script:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> ~/guix_demo/proj1
guix time-machine -C channels.scm -- environment --ad-hoc -m pkgs.scm -- Rscript fit1.R
</code></pre></td></tr></table>
</div>
</div><p>The output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">[1]     train-auc:1.000000
[2]     train-auc:1.000000
[3]     train-auc:1.000000
[4]     train-auc:1.000000
[5]     train-auc:1.000000
[6]     train-auc:1.000000
[7]     train-auc:1.000000
[8]     train-auc:1.000000
[9]     train-auc:1.000000
[10]    train-auc:1.000000
##### xgb.Booster
raw: 2.6 Kb
call:
  xgb.train(params = params, data = dtrain, nrounds = nrounds,
    watchlist = watchlist, verbose = verbose, print_every_n = print_every_n,
    early_stopping_rounds = early_stopping_rounds, maximize = maximize,
    save_period = save_period, save_name = save_name, xgb_model = xgb_model,
    callbacks = callbacks)
params (as set within xgb.train):
  max_depth = &#34;3&#34;, eta = &#34;1&#34;, nthread = &#34;1&#34;, objective = &#34;binary:logistic&#34;, eval_metric = &#34;auc&#34;, silent = &#34;1&#34;
xgb.attributes:
  niter
callbacks:
  cb.print.evaluation(period = print_every_n)
  cb.evaluation.log()
# of features: 4
niter: 10
nfeatures : 4
evaluation_log:
    iter train_auc
       1         1
       2         1
---
       9         1
      10         1
</code></pre></td></tr></table>
</div>
</div><h2 id="run-r-script-for-the-second-project">Run R script for the second project</h2>
<p>We also run an R script:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> ~/guix_demo/proj2
guix time-machine -C channels.scm -- environment --ad-hoc -m pkgs.scm -- Rscript fit2.R
</code></pre></td></tr></table>
</div>
</div><p>The output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Loading required package: Matrix
Loaded glmnet 4.1
           Length Class     Mode
a0          78    -none-    numeric
beta       312    dgCMatrix S4
df          78    -none-    numeric
dim          2    -none-    numeric
lambda      78    -none-    numeric
dev.ratio   78    -none-    numeric
nulldev      1    -none-    numeric
npasses      1    -none-    numeric
jerr         1    -none-    numeric
offset       1    -none-    logical
classnames   2    -none-    character
call         4    -none-    call
nobs         1    -none-    numeric

Call:  glmnet(x = iris_x, y = is_setosa, family = &#34;binomial&#34;)

   Df  %Dev  Lambda
1   0  0.00 0.43500
2   1 11.32 0.39640
3   1 20.79 0.36110
4   1 28.87 0.32910
5   1 35.87 0.29980
6   1 41.99 0.27320
7   1 47.38 0.24890
8   1 52.17 0.22680
9   1 56.44 0.20670
10  1 60.27 0.18830
11  1 63.72 0.17160
12  1 66.83 0.15630
13  1 69.64 0.14240
14  1 72.19 0.12980
15  1 74.51 0.11830
16  2 76.69 0.10780
17  2 78.74 0.09818
18  2 80.61 0.08946
19  2 82.30 0.08151
20  2 83.83 0.07427
21  2 85.23 0.06767
22  2 86.49 0.06166
23  2 87.65 0.05618
24  2 88.70 0.05119
25  2 89.67 0.04664
26  2 90.54 0.04250
27  2 91.34 0.03872
28  2 92.08 0.03528
29  2 92.74 0.03215
30  2 93.35 0.02929
31  2 93.91 0.02669
32  2 94.42 0.02432
33  2 94.89 0.02216
34  2 95.32 0.02019
35  2 95.71 0.01840
36  2 96.07 0.01676
37  2 96.40 0.01527
38  2 96.70 0.01392
39  2 96.97 0.01268
40  2 97.22 0.01155
41  2 97.45 0.01053
42  2 97.67 0.00959
43  2 97.86 0.00874
44  2 98.04 0.00796
45  2 98.20 0.00726
46  3 98.35 0.00661
47  3 98.49 0.00602
48  3 98.62 0.00549
49  3 98.73 0.00500
50  3 98.84 0.00456
51  3 98.94 0.00415
52  3 99.03 0.00378
53  3 99.11 0.00345
54  3 99.19 0.00314
55  3 99.25 0.00286
56  3 99.32 0.00261
57  3 99.37 0.00238
58  3 99.43 0.00216
59  3 99.48 0.00197
60  3 99.52 0.00180
61  3 99.56 0.00164
62  3 99.60 0.00149
63  3 99.63 0.00136
64  3 99.66 0.00124
65  3 99.69 0.00113
66  3 99.72 0.00103
67  3 99.74 0.00094
68  3 99.76 0.00085
69  3 99.78 0.00078
70  3 99.80 0.00071
71  3 99.82 0.00065
72  3 99.83 0.00059
73  3 99.85 0.00054
74  3 99.86 0.00049
75  3 99.87 0.00045
76  3 99.88 0.00041
77  3 99.89 0.00037
78  3 99.90 0.00034
</code></pre></td></tr></table>
</div>
</div><h2 id="a-possible-way-to-manage-dependency-using-guix-on-jenkins">A possible way to manage dependency using Guix on Jenkins</h2>
<p>We briefly discuss using Guix to help manage dependencies for jobs
running on Jenkins.</p>
<figure><img src="/ox-hugo/guix_intro_jenkins.png"
         alt="Figure 1: Illustration of using Guix for dependency management with Jenkins"/><figcaption>
            <p>Figure 1: Illustration of using Guix for dependency management with Jenkins</p>
        </figcaption>
</figure>

<ul>
<li><strong>Basic ideas:</strong>
<ul>
<li>
<p>the Guix package manager can be installed along with Jenkins on
a Linux distribution</p>
</li>
<li>
<p>the Jenkins can be a single master node, or one master node with
one or more worker nodes</p>
</li>
<li>
<p>each master or worker node that may need to run jobs needs to
have the Guix package manager installed</p>
<ul>
<li>if private channels are used, they need to be configured in
each master or worker node</li>
</ul>
</li>
<li>
<p>optionally, one or more nodes can also be a substitution server by running <code>guix publish</code></p>
<ul>
<li>the Guix in each master or worker node would need to be
configured to have this extra substitution server</li>
<li>if there is one node in the same network used for development
(e.g. an VM in AWS Virtual Private Cloud), it is an ideal
candidate to serve as the substitution server because during
development, the needed packages for a project need to be
downloaded or built anyway, so can be shared to other worker
nodes when the script is later run in batch mode, to save
re-building the packages in the worker nodes.</li>
</ul>
</li>
<li>
<p>the dependencies of each project (or job) is recorded in the
associated git repository, e.g. by having one manifest file
<code>pkgs.scm</code>, and one channels files <code>channels.scm</code>.</p>
</li>
<li>
<p>the Jenkins job can run <code>guix time-machine</code> and <code>guix environment</code> as discussed above:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">guix time-machine -C channels.scm -- environment -m pkgs.scm -- THE_COMMAND_HERE
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li><strong>Benefits:</strong>
<ul>
<li>due to the reproducibility of Guix, we can be confident that the
packages used in development are the exact same versions as in
the batch jobs</li>
<li>the dependencies of each projects are also version controlled in
the project git repository.</li>
<li>this method is hassle-free:
<ul>
<li>no need to manually install needed dependencies in needed worker nodes</li>
<li>will not &ldquo;forget&rdquo; to update the dependencies in some worker nodes</li>
<li>there will not conflicts of dependencies for different
projects, because each job is run in a <code>guix environment</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="what-s-next">What&rsquo;s next?</h2>
<p>In this part we showed a little demo of using Guix to manage
per-project dependencies using the <code>guix time-machine</code> and <code>guix environment</code> commands, mainly for batch script execution. Next time we
attempt to do the same per-project dependency management when you are
developing locally (not necessarily in Linux) and connecting to a remote
server (or a local VM) with Guix installed.</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Peter Lo</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2021-05-13
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/guix/">Guix</a>
          <a href="/tags/functional-package-manager/">Functional Package Manager</a>
          <a href="/tags/reproducibility/">Reproducibility</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/guix_intro_6_dev/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Guix Introduction Part 6: R Development with Guix</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/guix_intro_4_try/">
            <span class="next-text nav-default">Guix Introduction Part 4: Try Guix</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'https-peterloleungyau-github-io';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:peterloleungyau@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/leung-yau-lo-7a3274167/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/peterloleungyau" class="iconfont icon-github" title="github"></a>
  <a href="https://peterloleungyau.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Peter Lo</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-139262854-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
